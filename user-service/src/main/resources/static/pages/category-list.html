<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A fully featured admin theme which can be used to build CRM, CMS, etc.">
    <meta name="author" content="Coderthemes">

    <!-- App favicon -->
    <link rel="shortcut icon" href="../../assets/images/favicon.ico">
    <!-- App title -->
    <title>Zircos - Responsive Admin Dashboard Template</title>

    <!-- DataTables -->
    <link href="../../plugins/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/buttons.bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/fixedHeader.bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/responsive.bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/scroller.bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/dataTables.colVis.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/dataTables.bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/fixedColumns.dataTables.min.css" rel="stylesheet" type="text/css"/>

    <!-- Custom box css -->
    <link href="../../plugins/custombox/css/custombox.min.css" rel="stylesheet">
    <!-- App css -->
    <link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../../assets/css/core.css" rel="stylesheet" type="text/css" />
    <link href="../../assets/css/components.css" rel="stylesheet" type="text/css" />
    <link href="../../assets/css/icons.css" rel="stylesheet" type="text/css" />
    <link href="../../assets/css/pages.css" rel="stylesheet" type="text/css" />
    <link href="../../assets/css/menu.css" rel="stylesheet" type="text/css" />
    <link href="../../assets/css/responsive.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="../../plugins/switchery/switchery.min.css">

    <!-- HTML5 Shiv and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

</head>


<body class="fixed-left">

<!-- Loader -->
<div id="preloader">
    <div id="status">
        <div class="spinner">
            <div class="spinner-wrapper">
                <div class="rotator">
                    <div class="inner-spin"></div>
                    <div class="inner-spin"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Begin page -->
<div id="wrapper">

    <!-- Top Bar Start -->
    <div class="topbar">

        <!-- LOGO -->
        <div class="topbar-left">
            <a href="#" class="logo"><span>汇致旺<span>控制台</span></span><i class="mdi mdi-cube"></i></a>
            <!-- Image logo -->
            <!--<a href="index.html" class="logo">-->
            <!--<span>-->
            <!--<img src="../../assets/images/logo.png" alt="" height="30">-->
            <!--</span>-->
            <!--<i>-->
            <!--<img src="../../assets/images/logo_sm.png" alt="" height="28">-->
            <!--</i>-->
            <!--</a>-->
        </div>

        <!-- Button mobile view to collapse sidebar menu -->
        <div class="navbar navbar-default" role="navigation">
            <div class="container">

                <!-- Navbar-left -->
                <ul class="nav navbar-nav navbar-left">
                    <li>
                        <button class="button-menu-mobile open-left waves-effect waves-light">
                            <i class="mdi mdi-menu"></i>
                        </button>
                    </li>
                </ul>

                <!-- Right(Notification) -->
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="javascript:void(0);" class="right-bar-toggle right-menu-item">
                            <i class="mdi mdi-settings"></i>
                        </a>
                    </li>

                    <li class="dropdown user-box">
                        <a href="" class="dropdown-toggle waves-effect waves-light user-link" data-toggle="dropdown" aria-expanded="true">
                            <img src="../../assets/images/users/default.png" alt="user-img" class="img-circle user-img">
                        </a>

                        <ul class="dropdown-menu dropdown-menu-right arrow-dropdown-menu arrow-menu-right user-list notify-list">
                            <li>
                                <h5>Hi, John</h5>
                            </li>
                            <li><a href="javascript:void(0)"><i class="ti-settings m-r-5"></i> Settings</a></li>
                            <li><a href="javascript:void(0)"><i class="ti-power-off m-r-5"></i> Logout</a></li>
                        </ul>
                    </li>

                </ul> <!-- end navbar-right -->

            </div><!-- end container -->
        </div><!-- end navbar -->
    </div>
    <!-- Top Bar End -->


    <!-- ========== Left Sidebar Start ========== -->
    <div class="left side-menu">
        <div class="sidebar-inner slimscrollleft">

            <!--- Sidemenu -->
            <div id="sidebar-menu">
                <ul id ="ul_has_sub">
                    <li class="menu-title">Navigation</li>

                </ul>
            </div>
            <!-- Sidebar -->
            <div class="clearfix"></div>

            <div class="help-box">
                <h5 class="text-muted m-t-0">帮助 ？</h5>
                <p class=""><span class="text-dark"><b>Email:</b></span> <br/> 汇致旺</p>
                <p class="m-b-0"><span class="text-dark"><b>Call:</b></span> <br/> </p>
            </div>

        </div>
        <!-- Sidebar -left -->

    </div>
    <!-- Left Sidebar End -->



    <!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="content-page">
        <!-- Start content -->
        <div class="content">
            <div class="container">

                <div class="row">
                    <div class="col-xs-12">
                        <div class="page-title-box">
                            <h4 class="page-title"> </h4>
                            <ol class="breadcrumb p-0 m-0">
                                <li>
                                    <a href="#">汇致旺</a>
                                </li>
                                <li class="active">
                                    <a href="#">投资人管理</a>
                                </li>
                                <li class="active">
                                    投资人详情
                                </li>

                            </ol>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div>
                <!-- end row -->


                <div class="row">
                    <div class="col-sm-12">
                        <form class="form-horizontal" id="search_form" action="#">
                            <div class="card-box">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="card-box">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <form class="form-horizontal">

                                                        <div class="form-group">
                                                            <label class="col-md-2 control-label">手机号:</label>
                                                            <div class="col-md-10">
                                                                <label class="col-md-6 control-label" id ="mobile">18234123124</label>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-md-2 control-label">邮箱:</label>
                                                            <div class="col-md-10">
                                                                <label class="col-md-6 control-label" id ="email">943044485@qq.com</label>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-md-2 control-label">状态:</label>
                                                            <div class="col-md-10">
                                                                <label class="col-md-6 control-label" id ="state">已实名已认证</label>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-md-2 control-label">身份证:</label>
                                                            <div class="col-md-10">
                                                                <label class="col-md-6 control-label" id="idCardNumber">231243213214123214</label>
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <label class="col-md-2 control-label">卡号:</label>
                                                            <div class="col-md-10">
                                                                <label class="col-md-6 control-label" id="bankCardNumber">3241234123412351324132</label>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-sm-4">
                                                                <img id ="idCardPngUp" src="../../assets/images/small/img-1.jpg" alt="image"
                                                                     class="img-responsive img-rounded" width="200"/>
                                                            </div>
                                                            <div class="col-sm-4">
                                                                <img id ="idCardPngDown" src="../../assets/images/small/img-1.jpg" alt="image"
                                                                     class="img-responsive img-rounded" width="200"/>
                                                            </div>

                                                        </div>
                                                    </form>
                                                </div>

                                            </div>

                                        </div>
                                    </div>
                                </div>

                            </div>
                        </form>
                    </div>
                    <div class="col-sm-12">
                        <div class="card-box table-responsive">
                            <h4 class="m-t-0 header-title"><b>投资详情</b></h4>

                            <table id="datatable" class="table table-striped  table-colored table-info">
                                <thead>
                                <tr>
                                    <th>项目id</th>
                                    <th>项目名称</th>
                                    <th>预期月收益</th>
                                    <th>预期承受风险</th>
                                    <th>投入保证金</th>
                                    <th>资金配比</th>
                                    <th>入金时间</th>
                                    <th>投资状态</th>
                                    <th style="width: 50px">操作</th>
                                </tr>
                                </thead>


                                <tbody>

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- end row -->
            </div> <!-- container -->

        </div> <!-- content -->

        <footer class="footer text-right">
            2016 - 2018 © Zircos.
        </footer>

    </div>

    <div id="custom-modal" class="modal-demo" >
        <input type="hidden" placeholder="" id="row-id" class="form-control">

        <button type="button" class="close" onclick="Custombox.close();">
            <span>&times;</span><span class="sr-only">Close</span>
        </button>
        <div class="panel panel-color panel-teal">
            <div class="panel-heading">
                <h3 class="panel-title">信息提示</h3>
            </div>
            <div class="panel-body">
                <span id="box-message"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info waves-effect waves-light" id="confirm-del">&nbsp;确&nbsp;&nbsp;认&nbsp;</button>
                <button type="button" class="btn btn-default waves-effect" data-dismiss="modal" onclick="Custombox.close();">&nbsp;取&nbsp;&nbsp;消&nbsp;</button>
            </div>
        </div>
    </div>

    <!-- ============================================================== -->
    <!-- End Right content here -->
    <!-- ============================================================== -->

</div>
<!-- END wrapper -->

<script>
    var resizefunc = [];
</script>

<!-- jQuery  -->
<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/bootstrap.min.js"></script>
<script src="../../assets/js/detect.js"></script>
<script src="../../assets/js/fastclick.js"></script>
<script src="../../assets/js/jquery.blockUI.js"></script>
<script src="../../assets/js/waves.js"></script>
<script src="../../assets/js/jquery.slimscroll.js"></script>
<script src="../../assets/js/jquery.scrollTo.min.js"></script>
<script src="../../plugins/switchery/switchery.min.js"></script>

<script src="../../plugins/datatables/jquery.dataTables.min.js"></script>
<script src="../../plugins/datatables/dataTables.bootstrap.js"></script>

<script src="../../plugins/datatables/dataTables.buttons.min.js"></script>
<script src="../../plugins/datatables/buttons.bootstrap.min.js"></script>
<script src="../../plugins/datatables/jszip.min.js"></script>
<script src="../../plugins/datatables/pdfmake.min.js"></script>
<script src="../../plugins/datatables/vfs_fonts.js"></script>
<script src="../../plugins/datatables/buttons.html5.min.js"></script>
<script src="../../plugins/datatables/buttons.print.min.js"></script>
<script src="../../plugins/datatables/dataTables.fixedHeader.min.js"></script>
<script src="../../plugins/datatables/dataTables.keyTable.min.js"></script>
<script src="../../plugins/datatables/dataTables.responsive.min.js"></script>
<script src="../../plugins/datatables/responsive.bootstrap.min.js"></script>
<script src="../../plugins/datatables/dataTables.scroller.min.js"></script>
<script src="../../plugins/datatables/dataTables.colVis.js"></script>
<script src="../../plugins/datatables/dataTables.fixedColumns.min.js"></script>

<!-- init -->
<script src="../../assets/pages/jquery.datatables.init.js"></script>

<!-- Modal-Effect -->
<script src="../../plugins/custombox/js/custombox.min.js"></script>
<script src="../../plugins/custombox/js/legacy.min.js"></script>

<!-- App js -->
<script src="../../assets/js/jquery.core.js"></script>
<script src="../../assets/js/jquery.app.js"></script>
<script src="../../assets/js/jquery.validate.min.js"></script>
<script src="../../assets/js/jquery.cookie.js"></script>

<script>
    var table;
    var token = $.cookie('token');
    function getvalue(name) {

        var str = window.location.search;   //location.search是从当前URL的?号开始的字符串
        if (str.indexOf(name) != -1) {
            var pos_start = str.indexOf(name) + name.length + 1;
            var pos_end = str.indexOf("&", pos_start);
            if (pos_end == -1) {
               return str.substring(pos_start);
            } else {
                alert("没有此值~~");
            }
        }
    }

    function update(id,projectName,monthEarnings,expectedRiskTolerance,minMargin,moneyProportion,gmtCreated,isOnline){
        showOrHide(1);
        $('#row-id-1').val(id);
        $('#projectName').val(projectName);
        $('#monthEarnings').val(monthEarnings);
        $('#expectedRiskTolerance').val(expectedRiskTolerance);
        $('#minMargin').val(minMargin);
        $('#moneyProportion').val(moneyProportion);
        $('#gmtCreated').val(gmtCreated);
        $(":radio[name='isOnline'][value='" + isOnline + "']").prop("checked", "checked");
        $("#myModalLabel").text("更新");
        $('#myModal').modal();
    }
    function showSecurity(security,obj){
        $(obj).parents('span').html(security);
    }
    $("#btn_add").click(function () {
        showOrHide(1);
        $('#projectName').val("");
        $('#monthEarnings').val("");
        $('#expectedRiskTolerance').val("");
        $('#minMargin').val("");
        $('#moneyProportion').val("");
        $('#gmtCreated').val("");
        $("#myModalLabel").text("新增");
        $('#myModal').modal();
    });
    function online(id ,isOnline){
        showOrHide(0);
        $('#row-id-1').val(id);
        $(":radio[name='isOnline'][value='" + isOnline + "']").prop("checked", "checked");
        $("#myModalLabel").text("更新");
        $('#myModal').modal();
    }
    function showOrHide (state) {
        if (state && state === 1) {
            $('#dc_1').show();
            $('#dc_2').show();
            $('#dc_3').show();
            $('#dc_4').show();
            $('#dc_5').show();
        } else {
            $('#dc_1').hide();
            $('#dc_2').hide();
            $('#dc_3').hide();
            $('#dc_4').hide();
            $('#dc_5').hide();
        }
    }
    function formatDate(inputTime){
        var date = new Date(inputTime);
        var y = date.getFullYear();
        var m = date.getMonth() + 1;
        m = m < 10 ? ('0' + m) : m;
        var d = date.getDate();
        d = d < 10 ? ('0' + d) : d;
        var h = date.getHours();
        h = h < 10 ? ('0' + h) : h;
        var minute = date.getMinutes();
        var second = date.getSeconds();
        minute = minute < 10 ? ('0' + minute) : minute;
        second = second < 10 ? ('0' + second) : second;
        return y + '-' + m + '-' + d+' '+h+':'+minute+':'+second;
    }
    function showUI () {
        $.ajax({
            dataType : "json",
            url: host+"/loadUrls",
            contentType: 'application/json;charset=UTF-8',
            type: 'POST',
            success:function(data){
                if(!data.success){
                    alert(data.message);
                }else{
                    $.each(data.value, function(i, item) {
                        $("#ul_has_sub").append(
                            "<li class=\"has_sub\">" +
                            "<a href=\"" +
                            item.url +
                            "\" class=\"waves-effect\"><i class=\"mdi mdi-google-play\"></i>" +
                            " <span>"+
                            item.name
                            +"</span></a>"
                            +"</li>"
                        );
                    });
                }
            },
            error: function(res){
                authorValidate(res);
            }
        });
    }
    function getUserInfo(id){
        var param ={};
        param.id = id;
        $.ajax({
            dataType : "json",
            url : host+"/investor/getUserInfo",
            contentType: 'application/json;charset=UTF-8',
            type : "post",
            data : JSON.stringify(param),
            success : function(data) {
                if(!data.success){
                    alert(data.message);
                }else{
                    $('#mobile').text(data.value.account);
                    $('#email').text(data.value.email);
                    if (data.value.state === 100) {
                        $('#state').text("未实名未绑卡");
                    }else if (data.value.state === 110) {
                        $('#state').text("已实名未绑卡");
                    }else if (data.value.state === 111) {
                        $('#state').text("实名绑卡");
                    }else if (data.value.state === 101) {
                        $('#state').text("未实名已绑卡");
                    }
                    $('#idCardNumber').text(data.value.idCardNumber);
                    $('#bankCardNumber').text(data.value.bankCardNumber);
                    $('#idCardPngUp').attr("src",data.value.idCardPngUp);
                    $('#idCardPngDown').attr("src",data.value.idCardPngDown);
                    showTable(data.value.id);
                }
            },
            error : function (e){
                var d = e.responseJSON;
                if(d){
                    alert(d.message);
                }
            }
        });
    }
    function  showTable(investmenterId) {
        table = $('#datatable').DataTable({
            "processing" : false,
            "serverSide": true,
            "bLengthChange": false,     //关闭选择显示条数
            "bSort": false,             //不能排序
            "iDisplayLength": 10,
            "searching" : false,
            ajax(data, callback, settings){
                //封装请求参数
                var param = {};
                param.investmenterId = investmenterId;
                var info = $('#datatable').DataTable().page.info();
                var oTable = $("#datatable").dataTable(); //table1为表格的id
                var tableSetings=oTable.fnSettings();
                var paging_length=tableSetings._iDisplayLength;//当前每页显示多少
                var page_start=tableSetings._iDisplayStart;//当前页开始
                var page=(page_start / paging_length)+1;
                param.pageSize =info.length;       //页面显示记录条数，在页面显示每页显示多少项的时候
                param.currentPage = page;   //开始的记录序号
                $.ajax({
                    dataType : "json",
                    url: host+"/investor/getMyInvestment",
                    contentType: 'application/json;charset=UTF-8',
                    type: 'POST',
                    data :JSON.stringify(param),
                    success:function(res){
                        setTimeout( function () {
                            var out = {};
                            out.draw = data.draw;
                            out.recordsTotal = res.value.pageInfo.totalCount;
                            out.recordsFiltered = res.value.pageInfo.pageSize;
                            out.data =  res.value.data;
                            callback( out );
                        },50);
                    },
                    error: function(res){
                        authorValidate(res);
                    }
                });
            },
            "columns": [
                { data: 'id'},
                { data: 'projectName'},
                { data : 'monthEarnings'},
                { data: 'expectedRiskTolerance'},
                { data: 'inputMargin'},
                { data: 'moneyProportion'},
                { data : 'gmtCreated'},
                { data : 'stateDesc'},
                { data : null}
            ],
            columnDefs: [{
                targets: 6,
                render: function(data, type, row, meta) {
                    if(row.gmtCreated ){
                        return formatDate(row.gmtCreated);
                    }
                }
            },{
                targets: 8,
                render: function(data, type, row, meta) {
                    return '<a   type="button"  href="#" onclick="online(\'' + row.id + '\',\'' + row.isOnline + '\')" > 下架</a>';
                }
            }],
            language: {
                "sProcessing": "处理中...",
                "sLengthMenu": "显示 _MENU_ 项结果",
                "sZeroRecords": "没有匹配结果",
                "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
                "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
                "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
                "sInfoPostFix": "",
                "sSearch": "搜索:",
                "sUrl": "",
                "sEmptyTable": "表中数据为空",
                "sLoadingRecords": "载入中...",
                "sInfoThousands": ",",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上页",
                    "sNext": "下页",
                    "sLast": "末页"
                },
                "oAria": {
                    "sSortAscending": ": 以升序排列此列",
                    "sSortDescending": ": 以降序排列此列"
                }
            }
        });
    }
    $(document).ready(function () {
        showUI ();
        var value = getvalue("id");
        getUserInfo(value);
    });
    TableManageButtons.init();
    $("#but_search").click(function(){
        table.ajax.reload();
    });

    $("#btn_submit").click(function(){
        var id =  $('#row-id-1').val(id);
        var node = $('#dc_1') ;
        var url =null;
        if (!id ) {
            url=   host+"/investment/saveProject";
        }  else if (node.is(':hidden')) {
            url=   host+"/article/onlineOrOffline";
        }
        else {
            url=   host+"/investment/onlineOrOffline";
        }
        var param = getFormData($("#search_form"));
        $.ajax({
            dataType : "json",
            url : url,
            contentType: 'application/json;charset=UTF-8',
            type : "post",
            data : JSON.stringify(param),
            success : function(data) {
                if(!data.success){
                    alert(data.message);
                }else{
                    table.ajax.reload();
                }
            },
            error : function (e){
                var d = e.responseJSON;
                if(d){
                    alert(d.message);
                }
            }
        });

    });

</script>


</body>
</html>