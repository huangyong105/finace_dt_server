<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A fully featured admin theme which can be used to build CRM, CMS, etc.">
    <meta name="author" content="Coderthemes">

    <!-- App favicon -->
    <link rel="shortcut icon" href="../../assets/images/favicon.ico">
    <!-- App title -->
    <title>Zircos - Responsive Admin Dashboard Template</title>

    <!-- DataTables -->
    <link href="../../plugins/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/buttons.bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/fixedHeader.bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/responsive.bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/scroller.bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/dataTables.colVis.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/dataTables.bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../plugins/datatables/fixedColumns.dataTables.min.css" rel="stylesheet" type="text/css"/>

    <!-- Custom box css -->
    <link href="../../plugins/custombox/css/custombox.min.css" rel="stylesheet">
    <!-- App css -->
    <link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../../assets/css/core.css" rel="stylesheet" type="text/css" />
    <link href="../../assets/css/components.css" rel="stylesheet" type="text/css" />
    <link href="../../assets/css/icons.css" rel="stylesheet" type="text/css" />
    <link href="../../assets/css/pages.css" rel="stylesheet" type="text/css" />
    <link href="../../assets/css/menu.css" rel="stylesheet" type="text/css" />
    <link href="../../assets/css/responsive.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="../../plugins/switchery/switchery.min.css">

    <!-- HTML5 Shiv and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

</head>


<body class="fixed-left">

<!-- Loader -->
<div id="preloader">
    <div id="status">
        <div class="spinner">
            <div class="spinner-wrapper">
                <div class="rotator">
                    <div class="inner-spin"></div>
                    <div class="inner-spin"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Begin page -->
<div id="wrapper">

    <!-- Top Bar Start -->
    <div class="topbar">

        <!-- LOGO -->
        <div class="topbar-left">
            <a href="#" class="logo"><span>汇致旺<span>控制台</span></span><i class="mdi mdi-cube"></i></a>
            <!-- Image logo -->
            <!--<a href="index.html" class="logo">-->
            <!--<span>-->
            <!--<img src="../../assets/images/logo.png" alt="" height="30">-->
            <!--</span>-->
            <!--<i>-->
            <!--<img src="../../assets/images/logo_sm.png" alt="" height="28">-->
            <!--</i>-->
            <!--</a>-->
        </div>

        <!-- Button mobile view to collapse sidebar menu -->
        <div class="navbar navbar-default" role="navigation">
            <div class="container">

                <!-- Navbar-left -->
                <ul class="nav navbar-nav navbar-left">
                    <li>
                        <button class="button-menu-mobile open-left waves-effect waves-light">
                            <i class="mdi mdi-menu"></i>
                        </button>
                    </li>
                </ul>

                <!-- Right(Notification) -->
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="javascript:void(0);" class="right-bar-toggle right-menu-item">
                            <i class="mdi mdi-settings"></i>
                        </a>
                    </li>

                    <li class="dropdown user-box">
                        <a href="" class="dropdown-toggle waves-effect waves-light user-link" data-toggle="dropdown" aria-expanded="true">
                            <img src="../../assets/images/users/default.png" alt="user-img" class="img-circle user-img">
                        </a>

                        <ul class="dropdown-menu dropdown-menu-right arrow-dropdown-menu arrow-menu-right user-list notify-list">
                            <li>
                                <h5>Hi, John</h5>
                            </li>
                            <li><a href="javascript:void(0)"><i class="ti-settings m-r-5"></i> Settings</a></li>
                            <li><a href="javascript:void(0)" id="logout"><i class="ti-power-off m-r-5"></i> Logout</a></li>
                        </ul>
                    </li>

                </ul> <!-- end navbar-right -->

            </div><!-- end container -->
        </div><!-- end navbar -->
    </div>
    <!-- Top Bar End -->


    <!-- ========== Left Sidebar Start ========== -->
    <div class="left side-menu">
        <div class="sidebar-inner slimscrollleft">

            <!--- Sidemenu -->
            <div id="sidebar-menu">
                <ul id ="ul_has_sub">
                    <li class="menu-title">Navigation</li>

                </ul>
            </div>
            <!-- Sidebar -->
            <div class="clearfix"></div>

            <div class="help-box">
                <h5 class="text-muted m-t-0">帮助 ？</h5>
                <p class=""><span class="text-dark"><b>Email:</b></span> <br/> 汇致旺</p>
                <p class="m-b-0"><span class="text-dark"><b>Call:</b></span> <br/> </p>
            </div>

        </div>
        <!-- Sidebar -left -->

    </div>
    <!-- Left Sidebar End -->



    <!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="content-page">
        <!-- Start content -->
        <div class="content">
            <div class="container">

                <div class="row">
                    <div class="col-xs-12">
                        <div class="page-title-box">
                            <h4 class="page-title"> </h4>
                            <ol class="breadcrumb p-0 m-0">
                                <li>
                                    <a href="#">汇致旺</a>
                                </li>
                                <li class="active">
                                    用户管理
                                </li>
                            </ol>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div>
                <!-- end row -->


                <div class="row">
                    <div class="col-sm-12">
                        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                            <form class="form-horizontal" id="search_form" action="#">
                                <input type="hidden" placeholder="" id="row-id-1" name ="id" class="form-control">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                        <h4 class="modal-title" id="myModalLabel">新增</h4>
                                    </div>
                                    <div class="modal-body">

                                        <div class="form-group">
                                            <label for="name">名称</label>
                                            <input type="text" name="name" class="form-control" id="name" placeholder="名称">
                                        </div>
                                        <div class="form-group">
                                            <label for="mobile">手机号</label>
                                            <input type="text" name="mobile" class="form-control" id="mobile" placeholder="手机号">
                                        </div>
                                        <div class="form-group">
                                            <label for="password">密码</label>
                                            <input type="text" name="password" class="form-control" id="password" placeholder="手机号">
                                        </div>
                                        <div class="form-group">
                                            <label for="email">邮箱</label>
                                            <input type="text" name="email" class="form-control" id="email" placeholder="邮箱">
                                        </div>
                                        <div class="form-group">
                                            <label for="inlineCheckbox11">管理权限</label><br/>
                                        <!--    <input type="text" name="perms" class="form-control" id="perms" placeholder="管理权限">-->
                                            <div class="checkbox checkbox-pink checkbox-inline checkbox-circle">
                                                <input type="checkbox" id="inlineCheckbox11" name="perms" value="1" checked>
                                                <label for="inlineCheckbox11">添加投资项目</label>
                                            </div>
                                            <div class="checkbox checkbox-pink checkbox-inline checkbox-circle">
                                                <input type="checkbox" id="inlineCheckbox21" value="2" name="perms" >
                                                <label for="inlineCheckbox21">添加文章</label>
                                            </div>
                                            <div class="checkbox checkbox-pink checkbox-inline checkbox-circle">
                                                <input type="checkbox" id="inlineCheckbox31" name="perms" value="3">
                                                <label for="inlineCheckbox31">投资人管理</label>
                                            </div>
                                            <div class="checkbox checkbox-pink checkbox-inline checkbox-circle">
                                                <input type="checkbox" id="inlineCheckbox41"  name="perms" value="4">
                                                <label for="inlineCheckbox41">用户管理</label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="txt_statu_1">用户状态</label><br/>
                                            <div class="radio radio-info radio-inline">
                                                <input type="radio" id="txt_statu_1" value="0" name="state" checked>
                                                <label for="txt_statu_1"> 激活 </label>
                                            </div>
                                            <div class="radio radio-inline">
                                                <input type="radio" id="txt_statu_2" value="1" name="state" >
                                                <label for="txt_statu_2"> 冻结 </label>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭</button>
                                        <button type="button" id="btn_submit" class="btn btn-primary" data-dismiss="modal"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>保存</button>
                                    </div>
                                </div>
                            </div>
                            </form>
                        </div>
                        </form>
                    </div>
                    <div class="col-sm-12">
                        <div class="card-box table-responsive">
                            <div class="row">
                                <h4 class="m-t-0 header-title" style="float:left"><b>&nbsp;&nbsp;&nbsp;&nbsp;用户列表</b></h4>
                                <div class="col-md-1" style="float:right;">
                                    <button type="button" class="btn btn-info pull-right waves-effect waves-light" id="btn_add">创&nbsp;&nbsp;建</button>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                            <table id="datatable" class="table table-striped  table-colored table-info">
                                <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>名称</th>
                                    <th>手机号</th>
                                    <th>邮箱</th>
                                    <th>权限</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                                </thead>


                                <tbody>

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- end row -->
            </div> <!-- container -->

        </div> <!-- content -->

        <footer class="footer text-right">
            2016 - 2018 © Zircos.
        </footer>

    </div>

    <div id="custom-modal" class="modal-demo" >
        <input type="hidden" placeholder="" id="row-id" class="form-control">

        <button type="button" class="close" onclick="Custombox.close();">
            <span>&times;</span><span class="sr-only">Close</span>
        </button>
        <div class="panel panel-color panel-teal">
            <div class="panel-heading">
                <h3 class="panel-title">信息提示</h3>
            </div>
            <div class="panel-body">
                <span id="box-message"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info waves-effect waves-light" id="confirm-del">&nbsp;确&nbsp;&nbsp;认&nbsp;</button>
                <button type="button" class="btn btn-default waves-effect" data-dismiss="modal" onclick="Custombox.close();">&nbsp;取&nbsp;&nbsp;消&nbsp;</button>
            </div>
        </div>
    </div>

    <!-- ============================================================== -->
    <!-- End Right content here -->
    <!-- ============================================================== -->

</div>
<!-- END wrapper -->

<script>
    var resizefunc = [];
</script>

<!-- jQuery  -->
<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/bootstrap.min.js"></script>
<script src="../../assets/js/detect.js"></script>
<script src="../../assets/js/fastclick.js"></script>
<script src="../../assets/js/jquery.blockUI.js"></script>
<script src="../../assets/js/waves.js"></script>
<script src="../../assets/js/jquery.slimscroll.js"></script>
<script src="../../assets/js/jquery.scrollTo.min.js"></script>
<script src="../../plugins/switchery/switchery.min.js"></script>

<script src="../../plugins/datatables/jquery.dataTables.min.js"></script>
<script src="../../plugins/datatables/dataTables.bootstrap.js"></script>

<script src="../../plugins/datatables/dataTables.buttons.min.js"></script>
<script src="../../plugins/datatables/buttons.bootstrap.min.js"></script>
<script src="../../plugins/datatables/jszip.min.js"></script>
<script src="../../plugins/datatables/pdfmake.min.js"></script>
<script src="../../plugins/datatables/vfs_fonts.js"></script>
<script src="../../plugins/datatables/buttons.html5.min.js"></script>
<script src="../../plugins/datatables/buttons.print.min.js"></script>
<script src="../../plugins/datatables/dataTables.fixedHeader.min.js"></script>
<script src="../../plugins/datatables/dataTables.keyTable.min.js"></script>
<script src="../../plugins/datatables/dataTables.responsive.min.js"></script>
<script src="../../plugins/datatables/responsive.bootstrap.min.js"></script>
<script src="../../plugins/datatables/dataTables.scroller.min.js"></script>
<script src="../../plugins/datatables/dataTables.colVis.js"></script>
<script src="../../plugins/datatables/dataTables.fixedColumns.min.js"></script>

<!-- init -->
<script src="../../assets/pages/jquery.datatables.init.js"></script>

<!-- Modal-Effect -->
<script src="../../plugins/custombox/js/custombox.min.js"></script>
<script src="../../plugins/custombox/js/legacy.min.js"></script>

<!-- App js -->
<script src="../../assets/js/jquery.core.js"></script>
<script src="../../assets/js/jquery.app.js"></script>
<script src="../../assets/js/jquery.validate.min.js"></script>
<script src="../../assets/js/jquery.cookie.js"></script>

<script>
    var table;
    var token = $.cookie('token');
    function del(id,name){
        $('#row-id').val(id);
        //弹出提示框
        showCustombox("确认删除应用："+name,false);
    }

    function update(id,name,mobile,email,state,perms,password,idList){
        $('#row-id-1').val(id);
        $('#name').val(name);
        $('#mobile').val(mobile);
        $('#email').val(email);
        $('#password').val(password);
        arr  =idList.split(',')
        $(":radio[name='state'][value='" + state + "']").prop("checked", "checked");
        $(":checkbox").each(function(index) {
            $(this).prop('checked', false);
        });
        $(":checkbox").each(function(index) {
            val2= $(this).val();
            for (var i = 0;i<arr.length;i++) {
                if (arr[i] === val2) {
                    $(this).prop('checked', true);
                }
            };
        });
        $("#myModalLabel").text("更新");
        $('#myModal').modal();
    }
    function showSecurity(security,obj){
        $(obj).parents('span').html(security);
    }
    $("#btn_add").click(function () {
        $("#myModalLabel").text("新增");
        $('#myModal').modal();
    });

    function showUI () {
        $.ajax({
            dataType : "json",
            url: host+"/loadUrls",
            contentType: 'application/json;charset=UTF-8',
            type: 'POST',
            success:function(data){
                if(!data.success){
                    alert(data.message);
                }else{
                    $.each(data.value, function(i, item) {
                        $("#ul_has_sub").append(
                            "<li class=\"has_sub\">" +
                            "<a href=\"" +
                            item.url +
                            "\" class=\"waves-effect\"><i class=\"mdi mdi-google-play\"></i>" +
                            " <span>"+
                            item.name
                            +"</span></a>"
                            +"</li>"
                        );
                    });
                }
            },
            error: function(res){
                authorValidate(res);
            }
        });
    }
    $(document).ready(function () {
        showUI ();
        $('#confirm-del').click(function(){
            var id = $('#row-id').val();
            $.ajax({
                dataType : "json",
                url: host+"/uc/deleteSysUser",
                contentType: 'application/json;charset=UTF-8',
                type: 'POST',
                // 传给服务器的数据，可以添加我们自己的查询参数
                data: '{"id":"'+id+'"}',
                success:function(res){
                    table.ajax.reload();
                },
                error: function(res){
                    authorValidate(res);
                }
            });
            Custombox.close();
        });
        table = $('#datatable').DataTable({
            "processing" : false,
            "serverSide": false,
            "bLengthChange": false,     //关闭选择显示条数
            "bSort": false,             //不能排序
            "iDisplayLength": 10,
            "searching" : false,
            ajax(data, callback, settings){
                //封装请求参数
                var param = getFormData($("#search_form"));
                param.pageSize = data.length;       //页面显示记录条数，在页面显示每页显示多少项的时候
                param.currentPage = (data.start / data.length)+1;   //开始的记录序号
                $.ajax({
                    dataType : "json",
                    url: host+"/uc/findAllUsers",
                    contentType: 'application/json;charset=UTF-8',
                    type: 'POST',
                    data :JSON.stringify(param),
                    success:function(res){
                        setTimeout( function () {
                            var out = {};
                            out.draw = data.draw;
                            out.recordsTotal = res.value.length;
                            out.recordsFiltered =  res.value.length;
                            out.data =  res.value;
                            callback( out );
                        },50);
                    },
                    error: function(res){
                        authorValidate(res);
                    }
                });
            },
            "columns": [
                { data: 'id'},
                { data: 'name'},
                { data : 'mobile'},
                { data: 'email'},
                { data: 'perms'},
                { data : 'state'},
                { data : null}
            ],
            columnDefs: [{
                targets: 5,
                render: function(data, type, row, meta) {
                    if(row.state && row.state === 1){
                        return '冻结';
                    }else{
                        return '激活';
                    }
                }
            },{
                targets: 6,
                render: function(data, type, row, meta) {
                    return '<a type="button"  href="#" onclick="del(\'' + row.id + '\',\'' + row.name + '\')" >删除</a>&nbsp;&nbsp;<a type="button"  href="#" onclick="update(\'' + row.id + '\',\'' + row.name + '\',\'' + row.mobile + '\',\'' + row.email + '\',\'' + row.state + '\',\'' + row.perms + '\',\'' + row.password + '\',\'' + row.idList + '\')" >更新</a>';
                }
            }],
            language: {
                "sProcessing": "处理中...",
                "sLengthMenu": "显示 _MENU_ 项结果",
                "sZeroRecords": "没有匹配结果",
                "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
                "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
                "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
                "sInfoPostFix": "",
                "sSearch": "搜索:",
                "sUrl": "",
                "sEmptyTable": "表中数据为空",
                "sLoadingRecords": "载入中...",
                "sInfoThousands": ",",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上页",
                    "sNext": "下页",
                    "sLast": "末页"
                },
                "oAria": {
                    "sSortAscending": ": 以升序排列此列",
                    "sSortDescending": ": 以降序排列此列"
                }
            }
        });

    });
    TableManageButtons.init();
    $("#but_search").click(function(){
        table.ajax.reload();
    });
    $("#logout").click(function(){
        location.href="/logout"
    });
    $("#btn_submit").click(function(){
        $.ajax({
            dataType : "json",
            url : host+"/uc/createUser",
            type : "post",
            data : $('#search_form').serialize(),
            success : function(data) {
                if(!data.success){
                    alert(data.message);
                }else{
                    table.ajax.reload();
                }
            },
            error : function (e){
                var d = e.responseJSON;
                if(d){
                    alert(d.message);
                }
            }
        });

    });

</script>


</body>
</html>